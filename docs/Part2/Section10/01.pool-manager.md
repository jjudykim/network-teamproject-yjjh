### ğŸ”¹ ì˜¤ë¸Œì íŠ¸ í’€ë§(Object Pooling)ì´ë€?

---

- **ìì£¼ ìƒì„±/ì‚­ì œë˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ ì¬ì‚¬ìš©í•˜ëŠ” ë°©ì‹**
- ë§¤ë²ˆ `Instantiate`, `Destroy`ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¹„ìš©ì„ ì¤„ì—¬ **ì„±ëŠ¥ ìµœì í™”**

**ì™œ í•„ìš”í•œê°€?**

- ì‘ì€ ê·œëª¨ì˜ ê²Œì„ì´ë¼ë©´ **í•„ìˆ˜ëŠ” ì•„ë‹˜**
- í•˜ì§€ë§Œ **ê·œëª¨ê°€ ì»¤ì§€ê±°ë‚˜ ë°˜ë³µì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê°ì²´**(ëª¬ìŠ¤í„°, ìŠ¤í‚¬ ë“±)ê°€ ë§ë‹¤ë©´ ì„±ëŠ¥ ì €í•˜ ë°œìƒ
- ì´ëŸ´ ê²½ìš° **í’€ë§ì„ í†µí•´ ë©”ëª¨ë¦¬ ì¬í™œìš©**ì´ ìœ ìš©í•¨

> ì¦‰, ë©”ëª¨ë¦¬ í• ë‹¹/í•´ì œë¥¼ ì¤„ì´ê³ , GC(ê°€ë¹„ì§€ ì»¬ë ‰ì…˜) í˜¸ì¶œì„ ìµœì†Œí™”
>

<br>
<br>

### ğŸ”¹ ì‚¬ìš´ë“œ ë§¤ë‹ˆì €ì—ì„œë„ ì“°ì¸ ê°„ì ‘ì  í’€ë§

---

```csharp
if (_audioClips.TryGetValue(path, out audioClip) == false)
{
	audioClip = Managers.Resource.Load<AudioClip>(path);
	_audioClips.Add(path, audioClip);
}
```

- ì´ë¯¸ ë¡œë“œí•œ í´ë¦½ì„ **ìºì‹±í•˜ì—¬ ì¬ì‚¬ìš©**í•˜ëŠ” ë°©ì‹ = ë©”ëª¨ë¦¬ í’€ë§ê³¼ ìœ ì‚¬
- ğŸ¯ í•µì‹¬: **í•„ìš”í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³  ì¬ì‚¬ìš©í•œë‹¤ëŠ” ê°œë…**

<br>
<br>

### ğŸ”¹ ê°œë… ë¹„êµ: Instantiate vs Pool

---

| ë°©ì‹ | íŠ¹ì§• | ë¬¸ì œì  |
| --- | --- | --- |
| `Instantiate()` | ë§¤ë²ˆ ìƒˆ ê°ì²´ ìƒì„± | ìƒì„± ë¹„ìš© í¼, GC ë¶€í•˜ ë°œìƒ ê°€ëŠ¥ |
| `Destroy()` | ë©”ëª¨ë¦¬ì—ì„œ ì™„ì „ ì œê±° | ë‹¤ì‹œ í•„ìš”í•  ê²½ìš° ì¬ë¡œë“œ í•„ìš” |
| **Pooling** | ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬ | ë©”ëª¨ë¦¬ëŠ” ì°¨ì§€í•˜ì§€ë§Œ **ì„±ëŠ¥ì€ ë§¤ìš° ìš°ìˆ˜** |

**ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°: ì´¬ì˜ì¥ ë°°ìš° ëŒ€ê¸°ì‹¤**

- ê²Œì„ ì˜¤ë¸Œì íŠ¸ = ì´¬ì˜ ë°°ìš°
- Destroy = í‡´ê·¼ â†’ ë‹¤ìŒì— ë‹¤ì‹œ ë¶€ë¥´ë©´ ì§€ì—° ë°œìƒ
- **Pool = ëŒ€ê¸°ì‹¤**

  â†’ â€œí•„ìš” ì—†ì„ ë• ëŒ€ê¸°ì‹¤ì— ëŒ€ê¸°, í•„ìš”í•˜ë©´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°â€

<br>
<br>

### ğŸ”¹ Pooling ëŒ€ìƒ ì§€ì • ë°©ë²•

---

- ëª¨ë“  ì˜¤ë¸Œì íŠ¸ê°€ í’€ë§ ëŒ€ìƒì€ ì•„ë‹˜
    - âœ… ëª¬ìŠ¤í„°, ìŠ¤í‚¬, ì´ì•Œ ë“± ë°˜ë³µ ìƒì„±ë˜ëŠ” ì• ë“¤
    - âŒ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ, ì¹´ë©”ë¼ ë“±ì€ í’€ë§ í•„ìš” ì—†ìŒ
- í’€ë§ ëŒ€ìƒì€ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •
    - â­**`Poolable` ì»´í¬ë„ŒíŠ¸**ë¥¼ ì¶”ê°€í•˜ë©´ **í’€ë§ ëŒ€ìƒìœ¼ë¡œ ê°„ì£¼**â­ ****

```csharp
public class Poolable : MonoBehaviour
{
	public bool IsUsing;
}
```

<br>
<br>

### ğŸ”¹ Poolingì„ ê´€ë¦¬í•˜ëŠ” Pool Manager

---

**Managersì—ì„œ Pool Manager ê°ì²´ ìƒì„± ë° ë“±ë¡**

```csharp
PoolManager _pool = new PoolManager();
public static PoolManager Pool => Instance._pool;
```

- ë‹¤ë¥¸ ë§¤ë‹ˆì €ë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ `Managers`ì— ë“±ë¡
- ì „ì—­ ì ‘ê·¼ ê°€ëŠ¥

**PoolManagerì˜ ì„¸íŒ… (ì´ˆê¸° ì„¤ì •)**

```csharp
public class PoolManager
{
	Transform _root;

	public void Init()
	{
		if (_root == null)
		{
			_root = new GameObject { name = "@Pool_Root" }.transform;
			Object.DontDestroyOnLoad(_root);
		}
	}
}
```

- `@Pool_Root`ë¼ëŠ” **ê³µí†µ ë¶€ëª¨ ê°ì²´ ìƒì„±**
- ìƒì„±ëœ ì˜¤ë¸Œì íŠ¸ëŠ” ì—¬ê¸°ë¡œ ì´ë™ â†’ ë§ˆì¹˜ **ëŒ€ê¸°ì‹¤ì²˜ëŸ¼ ì •ë¦¬**

<br>
<br>

### ğŸ”¹ ë¦¬ì†ŒìŠ¤ ë§¤ë‹ˆì €ì™€ Poolingì˜ ì—°ë™

---

**Instantiate ê³¼ì •**

```csharp
GameObject prefab = Load<GameObject>($"Prefabs/{path}"); // 1. Load ê²°ê³¼ëŠ” ìºì‹±í•´ë‘ê³ 
GameObject go = Object.Instantiate(prefab, parent);      // 2. ê¸°ì¡´ì— í’€ë§ëœ ê°ì²´ë¥¼ ì¬ì‚¬ìš©í• ê¹Œ?
go.name = prefab.name;
```

- ì›ë˜ëŠ” ê²½ë¡œ ê¸°ë°˜ìœ¼ë¡œ Prefabì„ **ë¡œë“œ + ì¸ìŠ¤í„´ìŠ¤í™”**
- ê°œì„  ë°©í–¥
    1. `Load()` ê²°ê³¼ë¥¼ ìºì‹±
    2. ê¸°ì¡´ì— í’€ë§ëœ ê°ì²´ê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì¬ì‚¬ìš©

**Destroy ê³¼ì •**

```csharp
public void Destroy(GameObject go)
{
	if (go == null)
		return;

	Object.Destroy(go); // âŒ ì´ì œëŠ” ì´ê±° ëŒ€ì‹  Poolì— ë°˜í™˜
}
```

- âŒ ë§¤ë²ˆ Destroyí•˜ì§€ ë§ê³ 
- âœ… PoolManagerì˜ `Push()`ë¡œ **ì¬ì‚¬ìš© ëŒ€ê¸°ì—´ì— ë“±ë¡**

<br>
<br>

### ğŸ”¹ PoolManager ì¸í„°í˜ì´ìŠ¤ êµ¬ì„±

---

```csharp
public void Push(Poolable poolable) { ... }
public Poolable Pop(GameObject original, Transform parent = null) { ... }
public GameObject GetOriginal(string name) { ... }
```

- `Push()` â†’ ì˜¤ë¸Œì íŠ¸ë¥¼ í’€ì— ë°˜í™˜
- `Pop()` â†’ ì˜¤ë¸Œì íŠ¸ë¥¼ í’€ì—ì„œ êº¼ëƒ„ (ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±)
    - `original` : ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ìš”ì²­í–ˆëŠ”ì§€ ê¸°ì¤€ì´ ë˜ëŠ” í”„ë¦¬íŒ¹
    - `parent` : êº¼ë‚¸ ì˜¤ë¸Œì íŠ¸ë¥¼ ë¶™ì¼ ë¶€ëª¨
- `GetOriginal()` â†’ ì˜¤ë¦¬ì§€ë„ í”„ë¦¬íŒ¹ ì°¸ì¡° ë°˜í™˜

<br>
<br>

### ğŸ”¹ Poolable ì •ë¦¬ ê¸°ì¤€

---

- ê°™ì€ `Poolable`ì´ë¼ë„ ì¢…ë¥˜ê°€ ë‹¤ë¥´ë©´ ë¶„ë¦¬í•´ì•¼ í•¨
    - ì˜ˆ: `UnityChan`, `Tank`ë¥¼ ê°™ì€ í’€ì— ë„£ìœ¼ë©´ ë¬¸ì œ ë°œìƒ
- â¡ï¸ íƒ€ì…ë§ˆë‹¤ ë”°ë¡œ ë£¨íŠ¸ ì˜¤ë¸Œì íŠ¸ ìƒì„±
    - `UnityChan_Root`, `Tank_Root` ë“±

    ```
    @Pool_Root
    â”œâ”€â”€ UnityChan_Root
    â”‚   â”œâ”€â”€ UnityChan
    â”œâ”€â”€ Tank_Root
    â”‚   â”œâ”€â”€ Tank
    ```


**Pool ê´€ë¦¬ ìœ„í•œ ìë£Œêµ¬ì¡° ì„¤ê³„**

- Pool Managerì—ëŠ” ì—¬ëŸ¬ Poolë“¤ì´ ì¡´ì¬í•˜ë¯€ë¡œ, `Pool` í´ë˜ìŠ¤ë¥¼ ì œì‘í•´ í™œìš©

```csharp
class Pool
{
	public GameObject Original { get; private set; }
	public Transform Root { get; set; }
	
	Stack<Poolable> _poolStack = new Stack<Poolable>();
}
```

- í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ íƒ€ì…(Tank, UnityChan ë“±)ì„ ê´€ë¦¬í•˜ëŠ” ë‹¨ìœ„
- ë‚´ë¶€ì— Stackì„ ì‚¬ìš©í•´ **í›„ì…ì„ ì¶œ ë°©ì‹ìœ¼ë¡œ ê°ì²´ ë°˜í™˜/ì‚¬ìš©**

**PoolManagerì—ì„œ Poolì„ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°**

```csharp
Dictionary<string, Pool> _pool = new Dictionary<string, Pool>();
```

- ì´ë¦„ ê¸°ë°˜(key: string)ìœ¼ë¡œ í’€ ë‹¨ìœ„ ê°ì²´ë¥¼ êµ¬ë¶„
- `"UnityChan"`, `"Tank"` ë“± í”„ë¦¬íŒ¹ ì´ë¦„ìœ¼ë¡œ ê´€ë¦¬

<br>
<br>

### ğŸ”¹ PoolManager í†ºì•„ë³´ê¸°

---

```csharp
public class PoolManager
{
	// ê´€ë¦¬í•  Poolë“¤ì˜ êµ¬ë¶„ì„ ìœ„í•œ Pool í´ë˜ìŠ¤
	class Pool
	{
		public GameObject Original { get; private set; }
		public Transform Root { get; set; }
		
		Stack<Poolable> _poolStack = new Stack<Poolable>();
	}
	
	// Pool ì €ì¥ì†Œ
	Dictionary<string, Pool> _pool = new Dictionary<string, Pool>();
	Transform _root;
	
	public void Init()
	{
		if (_root = null)
		{
			_root = new GameObject { name = "@Pool_Root" }.transform;
			Object.DontDestroyOnLoad(_root);
		}
	}
	
	// ì˜¤ë¸Œì íŠ¸ë¥¼ í’€ì— ë°˜í™˜
	public void Push(Poolable poolable)
	{
	
	}
	
	// ì˜¤ë¸Œì íŠ¸ë¥¼ í’€ì—ì„œ êº¼ë‚´ ì¬ì‚¬ìš©
	public Pooable Pop(GameObject original, Transform parent = null)
	{
		
	}
}
```

<br>
<br>

### âœ… ê²°ë¡  ë° ì •ë¦¬

---

- **Object Pooling**ì€ ë°˜ë³µ ìƒì„±/ì‚­ì œ ë¹„ìš©ì„ ì¤„ì´ê¸° ìœ„í•œ ìµœì í™” ê¸°ë²•
- í’€ë§ ëŒ€ìƒì€ **ì»´í¬ë„ŒíŠ¸(Poolable)**ë¡œ ì§€ì •
- `PoolManager`ëŠ” ê° ì˜¤ë¸Œì íŠ¸ íƒ€ì…ë§ˆë‹¤ **ê°œë³„ Pool(Stack)** ê´€ë¦¬
- `Instantiate()`ì™€ `Destroy()`ëŠ” ì´ì œ **PoolManagerë¥¼ í†µí•´ ì¤‘ê³„**
- ì „ì²´ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íë¦„

```
[Prefab Load] â†’ [Instantiate or Pop]
                    â†“
            [ì‚¬ìš© í›„ Push â†’ Stack ì €ì¥]
```