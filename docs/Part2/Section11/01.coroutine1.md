# ìŠ¤í¬ë¦½íŠ¸

### ğŸ”¹**Coroutineì´ë€?**

---

**Coroutineì˜ ì •ì˜**

> í•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ì¼ì‹œì •ì§€í•˜ê³ , ë‹¤ìŒì— ê·¸ ì‹œì ë¶€í„° ë‹¤ì‹œ ì´ì–´ì„œ ì‹¤í–‰í•˜ëŠ” êµ¬ì¡°
>
>
> â†’ C#ì—ì„œëŠ” `yield return`ì„ í†µí•´ êµ¬í˜„ ê°€ëŠ¥
>

**ì½”ë£¨í‹´ì´ í•„ìš”í•œ ì´ìœ **

ê²Œì„ ê°œë°œ ì¤‘ ì—°ì‚°ëŸ‰ì´ ë§ì€ ì‘ì—…(ì˜ˆ: ê¸¸ì°¾ê¸° ì•Œê³ ë¦¬ì¦˜)ì„ **í•œ í”„ë ˆì„ ë‚´ì— ì „ë¶€ ì²˜ë¦¬í•˜ë©´ í”„ë ˆì„ ë“œë ë°œìƒ**

â‡’ í•´ê²°ì±…: **ì—¬ëŸ¬ í”„ë ˆì„ì— ê±¸ì³ ë¶„ì‚° ì‹¤í–‰**

- í•˜ì§€ë§Œ ì¼ë°˜ì ì¸ `for` ë£¨í”„ë¡œëŠ” **ìƒíƒœ ë³´ì¡´ì´ ì–´ë ¤ì›€**

  â†’ i ê°’, ë‚´ë¶€ ìƒíƒœ, ê³„ì‚° ë„ì¤‘ì˜ ìë£Œ ë“±ì„ ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì €ì¥/ë³µì›í•´ì•¼ í•¨ â†’ êµ¬í˜„ ë‚œì´ë„ ìƒìŠ¹

- âœ… **Coroutineì€ í•¨ìˆ˜ ìƒíƒœë¥¼ ë³´ì¡´í•œ ì±„, ë‹¤ìŒ í”„ë ˆì„ì— ì´ì–´ì„œ ì‹¤í–‰ ê°€ëŠ¥**

  â†’ ì¼ì‹œì •ì§€ì™€ ì¬ê°œê°€ ê°€ëŠ¥í•œ í•¨ìˆ˜ í˜•íƒœ!


ì¦‰, **ì½”ë“œ íë¦„ì„ ìœ ì§€í•˜ë©´ì„œ í”„ë ˆì„ ë‹¨ìœ„ë¡œ ëŠëŠ” ë°©ì‹**ì„ í™œìš© ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” êµ¬ì¡°!

**ì˜ˆì‹œ**

```csharp
void VeryComplicated()
{
	for (int i = 0; i < 10000000; ++i)
	{
		// ì—°ì‚°ëŸ‰ì´ í° ì‘ì—…
		if (i % 10000 == 0)
			break; // âŒ breakëŠ” ìƒíƒœë¥¼ ìœ ì§€í•˜ì§€ ëª»í•¨
	}
}
```

â¡ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ë©´ ië¥¼ ì™¸ë¶€ì— ë¹¼ì•¼ í•˜ê³ ,

ë‚˜ì•„ê°€ **í•¨ìˆ˜ ì „ì²´ ìƒíƒœ ë³´ì¡´**ì´ í•„ìš”í•¨ â†’ Coroutineì˜ í•„ìš”

<br>
<br>

### ğŸ”¹ **IEnumerator / IEnumerable ê¸°ë°˜ Coroutine**

---

```csharp
public class GameScene : BaseScene
{
	class CoroutineTest : IEnumerable
	{
		public IEnumerator GetEnumerator()
		{
			yield return 1;
			yield return 2;
			yield return 3;
			yield return 4;
		}
	}

	protected override void Init()
	{
		base.Init();
		SceneType = Define.Scene.Game;
		Managers.UI.ShowSceneUI<UI_Inven>();

		CoroutineTest test = new CoroutineTest();
		foreach (int value in test)
		{
			Debug.Log(value); // 1, 2, 3, 4 ìˆœì°¨ ì¶œë ¥
		}
	}
	
	// ...
}
```

- `yield return`ì€ ê°’ì„ ìˆœì°¨ì ìœ¼ë¡œ **ë¦¬í„´í•˜ë©´ì„œ ì¼ì‹œì •ì§€**
- `IEnumerator`ê°€ ìˆœíšŒ ê°€ëŠ¥í•œ ìƒíƒœë¡œ ë§Œë“¤ì–´ì¤Œ
- `foreach` êµ¬ë¬¸ì—ì„œ ìë™ìœ¼ë¡œ ë‹¤ìŒ yield ì§€ì ìœ¼ë¡œ ì´ë™

<br>
<br>

### ğŸ”¹ **object ë°˜í™˜ê³¼ í˜•ë³€í™˜ (ë°•ì‹±/ì–¸ë°•ì‹±)**

---

- `IEnumerator`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `System.Object` íƒ€ì…ì„ ë°˜í™˜í•¨

```csharp
ë³µì‚¬í¸ì§‘
foreach (object t in test)
{
	int value = (int)t; // ë°•ì‹±ëœ objectë¥¼ intë¡œ ì–¸ë°•ì‹±
}
```

â¡ ì–´ë–¤ íƒ€ì…ì´ë“  yield return ê°€ëŠ¥ (ex. `int`, `string`, `class` ë“±)

---

**ì‚¬ìš©ì ì •ì˜ í´ë˜ìŠ¤ë„ ë°˜í™˜ ê°€ëŠ¥**

```csharp
public class GameScene : BaseScene
{
	class Test { public int Id = 0; }

	class CoroutineTest : IEnumerable
	{
		public IEnumerator GetEnumerator()
		{
			yield return new Test { Id = 1 };
			yield return new Test { Id = 2 };
			yield return new Test { Id = 3 };
			yield return new Test { Id = 4 };
		}
	}

	protected override void Init()
	{
		base.Init();
		SceneType = Define.Scene.Game;
		Managers.UI.ShowSceneUI<UI_Inven>();

		CoroutineTest test = new CoroutineTest();
		foreach (object t in test)
		{
			Test value = (Test)t;
			Debug.Log(value.Id); // 1, 2, 3, 4 ìˆœì°¨ ì¶œë ¥
		}
	}
	
	// ...
}

```

- í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë„ yieldë¥¼ í†µí•´ ìˆœì°¨ ë°˜í™˜ ê°€ëŠ¥
- ë‚´ë¶€ì—ì„œ ìƒíƒœë¥¼ ê°€ì§„ ê°ì²´ ì „ë‹¬ë„ ê°€ëŠ¥

<br>
<br>

### ğŸ”¹ **yield return null / yield break**

---

```csharp
public IEnumerator GetEnumerator()
{
	yield return null;  // ì¼ì‹œ ì •ì§€ (ê°’ ì—†ì´)
	yield break;        // ì™„ì „ ì¢…ë£Œ (ë¦¬í„´ ì¢…ë£Œ)
}
```

- `yield return null`: ê·¸ëƒ¥ í•œ Tick ì‰¬ê¸° (ê°’ì€ ì—†ìŒ, Tickì€ ë„˜ê¸°ê¸°)
- `yield break`: ì•„ì˜ˆ Coroutine ìˆœíšŒ ì¢…ë£Œ (ë§ˆì¹˜ `return`ê³¼ ê°™ì€ íš¨ê³¼)

<br>
<br>

### ğŸ”¹ **ë³µì¡í•œ ì—°ì‚°ì— Coroutine í™œìš© (ì˜ˆ: 100ë§Œë²ˆ ë£¨í”„)**

---

```csharp
public IEnumerator GetEnumerator()
{
	for (int i = 0; i < 1000000; ++i)
	{
		if (i % 10000 == 0)
			yield return null; // 1ë§Œ íšŒë§ˆë‹¤ ì¼ì‹œ ì •ì§€
	}
}
```

í° ë°˜ë³µë¬¸ì˜ **CPU ë¶€í•˜ë¥¼ í”„ë ˆì„ ë‹¨ìœ„ë¡œ ë¶„ì‚°**

â¡ ë¶€ë“œëŸ¬ìš´ í”„ë ˆì„ ìœ ì§€í•˜ë©´ì„œ ë³µì¡í•œ ì‘ì—… ê°€ëŠ¥

<br>
<br>

### âœ… ì •ë¦¬ ë° ê²°ë¡ 

---

| ê¸°ëŠ¥ | ì„¤ëª… |
| --- | --- |
| `yield return ê°’` | ê°’ì„ ë„˜ê¸°ë©° í•¨ìˆ˜ ì¼ì‹œì •ì§€ |
| `yield return null` | í‹± ë„˜ê¹€ (ë¬´ê°’ ë°˜í™˜) |
| `yield break` | ì½”ë£¨í‹´ ì¢…ë£Œ |
| `IEnumerator` | ì½”ë£¨í‹´ í•¨ìˆ˜ ì¸í„°í˜ì´ìŠ¤ |
| `foreach` | yield return ê°’ì„ ìˆœì°¨ ì²˜ë¦¬ |

â†’ Coroutineì€ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©´ì„œ ë³µì¡í•œ ì‘ì—…ì„ ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ ë„êµ¬

<br>
<br>

### ğŸ“Œ ìµœì¢… ì½”ë“œ ì •ë¦¬

---

**Scene_Game.cs**

```csharp
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Scene_Game : Scene_Base
{
    class Test
    {
        public int Id = 0;
    }

    class CoroutineTest : IEnumerable
    {
        public IEnumerator GetEnumerator()
        {
            yield return new Test { Id = 1 };
            yield return new Test { Id = 2 };
            yield return null;
            yield return new Test { Id = 3 };
            yield return new Test { Id = 4 };
        }
    }

    protected override void Init()
    {
        base.Init();

        SceneType = Define.Scene.Game;
        Managers.UI.ShowSceneUI<UI_Inven>();

        for (int i = 0; i < 10; ++i)
            Managers.Resource.Instantiate("Player");

        CoroutineTest test = new CoroutineTest();
        foreach (object t in test)
        {
            if (t != null)
            {
                Test value = (Test)t;
                Debug.Log(value.Id);
            }
        }
    }

    void Update()
    {
        
    }

    public override void Clear()
    {
    }
}

```