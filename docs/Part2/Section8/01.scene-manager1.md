# 스크립트

### 🔹 **씬 구조 관리의 필요성**

---

- 지금까지는 `PlayerController`가 모든 시스템을 호출하는 구조
- 하지만 이 구조는 플레이어가 반드시 씬에 존재한다는 가정이 필요!

  → 즉, MMORPG처럼 로그인 후 캐릭터를 생성하는 구조에는 부적절함

- 따라서 **플레이어가 아닌 별도의 '선봉대 역할' 객체가 씬 초기화를 담당해야 함**

<br>
<br>

### 🔹 **Define.Scene 열거형 추가**

---

```csharp
public class Define
{
    public enum Scene
    {
        Unknown,
        Login,
        Lobby,
        Game,
    }
}
```

- 씬 종류를 명시적으로 enum으로 정의하여 관리 일관성 확보

<br>
<br>

### 🔹 **BaseScene 클래스 설계**

---

```csharp
public abstract class BaseScene : MonoBehaviour
{
    public Define.Scene SceneType { get; protected set; } = Define.Scene.Unknown;

    void Start() { }

    protected virtual void Init()
    {
        // EventSystem 없으면 프리팹으로 생성
        Object obj = GameObject.FindObjectOfType(typeof(EventSystem));
        if (obj == null)
            Managers.Resource.Instantiate("UI/EventSystem").name = "@EventSystem";
    }

    public abstract void Clear();
}
```

- Scene 공통 부모 클래스 역할
- Define.Scene Enum 타입의 `SceneType` 속성으로 현재 씬의 종류를 보관
- `Init()` 함수에서 **초기화 공통 처리**, 특히 `EventSystem` 자동 생성 처리
- `Clear()`는 추상 메서드로 정의 → 각 씬에서 오버라이딩 필수, 나중에 씬 해제 시 정리할 내용들

<br>
<br>

### 🔹 **GameScene 구현**

---

```csharp
public class GameScene : BaseScene
{
    void Start()
    {
        Init();
    }

    protected override void Init()
    {
        base.Init();
        SceneType = Define.Scene.Game;

        Managers.UI.ShowSceneUI<UI_Inven>(); // 인벤토리 UI 표시
    }

    public override void Clear()
    {
        // 게임 씬 종료 시 정리 로직 작성
    }
}
```

- 씬 타입을 `Game`으로 설정하고, 인벤토리 UI를 띄움
- `Init()`에서 부모 `Init()` 호출 필수 → 이벤트 시스템 체크 포함됨

<br>
<br>

### 🔹 Scene GameObject 구조

---

- 씬마다 새로운 빈 게임 오브젝트 생성 → 이름: `@Scene` (선봉대 역할)
- 해당 오브젝트에 각 Scene Script (ex.GameScene, Login Scene) 컴포넌트를 부착하여 씬 초기화를 담당하게 함
- 씬의 초기화 책임을 가지는 선봉대 역할

<br>
<br>

### 🔹 **씬 전환 시 고려사항**

---

- 씬이 새로 로드되면 `EventSystem`이 사라지는 문제

  → `Init()`에서 존재 여부 확인 후 없으면 프리팹 생성으로 해결


- `Awake()` vs `Start()` :
    - `Start()`는 오브젝트가 비활성화 상태면 실행되지 않음
    - `Awake()`는 오브젝트가 꺼져 있어도 실행됨 → 더 안전한 초기화 타이밍 확보 가능

💡 Tip : `BaseScene`의 `Awake()`에서 `Init()`을 호출하면 파생 씬 클래스에서 Init을 빼먹어도 안전함

<br>
<br>

### 🔹 **LoginScene 구현**

---

```csharp
public class LoginScene : BaseScene
{
    protected override void Init()
    {
        base.Init();
        SceneType = Define.Scene.Login;
        // 로그인 UI 생성 예정
    }

    public override void Clear()
    {
        throw new System.NotImplementedException();
    }
}
```

- `@Scene` 오브젝트에 `LoginScene` 컴포넌트를 부착해서 @Scene이 선봉대 역할을 하게 함
- 앞으로 여기서 UI_Login같은 로그인 UI 호출 가능!

<br>
<br>

### ✅ 결론 및 정리

---

- 이제 각 씬은 `BaseScene`을 상속한 클래스에서 **초기화 및 UI 표시, 타입 지정, 정리** 등을 처리함
- `@Scene`이라는 오브젝트가 씬 전환 시 공통 초기화 역할을 하게 됨
- `EventSystem`도 누락되어 있으면 자동 생성되므로, 더 이상 수동으로 추가할 필요 없음
- `Init()` 호출 타이밍은 필요에 따라 `Start()` 혹은 `Awake()`에서 선택 가능